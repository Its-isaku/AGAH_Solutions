{% extends "emails/base_email.html" %}

{% block title %}Precio Final Disponible - AGAH Solutions{% endblock %}

{% block content %}
<!-- Greeting -->
<h2 style="margin: 0 0 20px 0; color: #F4E7E1; font-size: 24px; font-weight: 600;">
    Hola {{ customer_name|default:"Cliente" }},
</h2>

<p style="margin: 0 0 30px 0; color: #F4E7E1; font-size: 16px; line-height: 1.6;">
    Hemos finalizado la revisión completa de tu pedido. Aquí está el precio final y el tiempo de entrega para tu proyecto.
</p>

<!-- Order Info -->
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="background-color: rgba(120, 183, 208, 0.1); border-radius: 10px; border: 1px solid rgba(120, 183, 208, 0.3); margin-bottom: 30px;">
    <tr>
        <td style="padding: 20px;">
            <h3 style="margin: 0 0 15px 0; color: #78B7D0; font-size: 18px; text-align: center;">
                Pedido: {{ order.order_number }}
            </h3>
            <p style="margin: 0; color: #F4E7E1; font-size: 14px; text-align: center;">
                Estado: Precio Final Disponible
            </p>
        </td>
    </tr>
</table>

<!-- Final Price -->
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="background: linear-gradient(135deg, rgba(120, 183, 208, 0.2) 0%, rgba(120, 183, 208, 0.1) 100%); border-radius: 10px; border: 2px solid #78B7D0; margin-bottom: 30px;">
    <tr>
        <td style="padding: 30px; text-align: center;">
            <p style="margin: 0 0 10px 0; color: #F4E7E1; font-size: 18px;">PRECIO FINAL:</p>
            <p style="margin: 0; color: #78B7D0; font-size: 42px; font-weight: bold;">
                ${{ final_price|floatformat:2 }} MXN
            </p>
            {% if order.estimaded_price %}
            <p style="margin: 15px 0 0 0; color: #888888; font-size: 13px;">
                Precio estimado inicial: ${{ order.estimaded_price|floatformat:2 }} MXN
            </p>
            {% endif %}
        </td>
    </tr>
</table>

<!-- Delivery Time -->
{% if delivery_time %}
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="background-color: rgba(120, 183, 208, 0.1); border-radius: 10px; border: 1px solid rgba(120, 183, 208, 0.3); margin-bottom: 30px;">
    <tr>
        <td style="padding: 20px; text-align: center;">
            <p style="margin: 0 0 10px 0; color: #78B7D0; font-size: 16px; font-weight: 600;">
                Tiempo de Entrega:
            </p>
            <p style="margin: 0; color: #F4E7E1; font-size: 20px;">
                {{ delivery_time }} días hábiles
            </p>
        </td>
    </tr>
</table>
{% endif %}

<!-- Order Summary -->
<h3 style="margin: 0 0 20px 0; color: #78B7D0; font-size: 18px;">Resumen del Pedido:</h3>

<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-bottom: 30px;">
    {% for item in order.items.all %}
    <tr>
        <td style="padding: 15px; background-color: rgba(26, 26, 26, 0.3); border-bottom: 1px solid rgba(120, 183, 208, 0.2);">
            <table border="0" cellpadding="0" cellspacing="0" width="100%">
                <tr>
                    <td style="color: #F4E7E1; font-size: 16px; font-weight: 600;">
                        {{ item.service.name }}
                    </td>
                    <td align="right" style="color: #78B7D0; font-size: 16px; font-weight: 600;">
                        {% if item.final_price %}
                        ${{ item.final_price|floatformat:2 }}
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td colspan="2" style="color: #888888; font-size: 14px; padding-top: 5px;">
                        Cantidad: {{ item.quantity }}
                        {% if item.material %} | Material: {{ item.material }}{% endif %}
                    </td>
                </tr>
            </table>
        </td>
    </tr>
    {% endfor %}
</table>

<!-- Action Required -->
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="background-color: rgba(120, 183, 208, 0.05); border-radius: 10px; padding: 20px; margin-bottom: 30px;">
    <tr>
        <td style="text-align: center;">
            <p style="margin: 0 0 15px 0; color: #F4E7E1; font-size: 16px; font-weight: 600;">
                ¿Deseas proceder con tu pedido?
            </p>
            <p style="margin: 0; color: #888888; font-size: 14px; line-height: 1.6;">
                Por favor confirma o cancela tu pedido usando los botones a continuación.
            </p>
        </td>
    </tr>
</table>

<!-- CTA Buttons -->
<table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin: 30px 0;">
    <tr>
        <td align="center">
            <table border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <td style="padding-right: 10px;">
                        <a href="{{ website_url|default:'http://localhost:5173' }}/orders" 
                           style="display: inline-block; padding: 15px 30px; background-color: transparent; border: 2px solid #78B7D0; border-radius: 8px; color: #78B7D0; font-size: 16px; font-weight: 600; text-decoration: none; text-transform: uppercase; letter-spacing: 1px;">
                            Confirmar Pedido
                        </a>
                    </td>
                    <td style="padding-left: 10px;">
                        <a href="{{ website_url|default:'http://localhost:5173' }}/orders" 
                           style="display: inline-block; padding: 15px 30px; background-color: transparent; border: 2px solid #ef4444; border-radius: 8px; color: #ef4444; font-size: 16px; font-weight: 600; text-decoration: none; text-transform: uppercase; letter-spacing: 1px;">
                            Cancelar Pedido
                        </a>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>

<p style="margin: 30px 0 0 0; color: #888888; font-size: 14px; line-height: 1.6; text-align: center;">
    Si tienes alguna pregunta sobre el precio o necesitas ajustes, contáctanos respondiendo a este correo.
</p>
{% endblock %}